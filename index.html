<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Deploy Monitor</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #eee;
        padding: 20px;
      }
      h2 {
        color: #00ffcc;
      }
      .event {
        background: #1e1e1e;
        padding: 10px;
        margin-bottom: 10px;
        border-left: 4px solid #00ffcc;
      }
      .fail {
        border-left-color: red;
      }
      .success {
        border-left-color: limegreen;
      }
    </style>
  </head>
  <body>
    <h2>ðŸš€ Deploy Realtime Monitor</h2>
    <div id="events"></div>

    <script>
      const WS_URL = "ws://103.161.97.193:9000";
      const container = document.getElementById("events");

      function renderEvent(event) {
        const div = document.createElement("div");
        div.className =
          "event " + (event.status === "FAIL" ? "fail" : "success");

        div.innerHTML = `
            <strong>Service:</strong> ${event.service}<br>
            <strong>Status:</strong> ${event.status}<br>
            <strong>Message:</strong> ${event.message}<br>
            <strong>Commit:</strong> ${event.commit}<br>
            <strong>Time:</strong> ${event.time}
        `;

        container.prepend(div);
      }

      const ws = new WebSocket(WS_URL);

      ws.onopen = () => {
        console.log("Connected to WebSocket server");
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        console.log("Received:", data);

        if (data.type === "init") {
          container.innerHTML = "";
          data.data.forEach(renderEvent);
        }

        if (data.type === "deploy") {
          renderEvent(data.data);
        }
      };

      ws.onerror = (err) => {
        console.error("WebSocket error:", err);
      };

      ws.onclose = () => {
        console.log("WebSocket disconnected");
      };
    </script>
  </body>
</html>
