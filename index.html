<!doctype html>
<html>
  <head>
    <title>Deploy Monitor</title>
  </head>
  <body>
    <h2>Realtime Deploy Events</h2>
    <div id="events"></div>

    <script>
      const ws = new WebSocket("ws://103.161.97.193:9000");
      const container = document.getElementById("events");

      ws.onmessage = function (event) {
        const msg = JSON.parse(event.data);

        if (msg.type === "init") {
          msg.data.forEach(renderEvent);
        }

        if (msg.type === "deploy") {
          renderEvent(msg.data);
        }
      };

      function renderEvent(data) {
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.margin = "10px";
        div.style.padding = "10px";

        const files = Array.isArray(data.files_changed)
          ? data.files_changed.join(", ")
          : "N/A";

        div.innerHTML = `
        <b>Project:</b> ${data.project || data.service || "N/A"}<br>
        <b>Status:</b> ${data.status || "N/A"}<br>
        <b>Message:</b> ${data.message || "N/A"}<br>
        <b>Commit:</b> ${data.commit || "N/A"}<br>
        <b>Commit Message:</b> ${data.commit_message || "N/A"}<br>
        <b>Files:</b> ${files}<br>
        <b>Time:</b> ${data.time || "N/A"}
    `;

        container.prepend(div);
      }
    </script>
  </body>
</html>
